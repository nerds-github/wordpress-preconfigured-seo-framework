"use strict";window.tsfMedia=function(a){function b(a){const b=a.target;if(b.disabled||"undefined"==typeof wp.media)return a.preventDefault(),void a.stopPropagation();const d=b.dataset.inputType||"",g=b.dataset.inputId||"";let h;a.preventDefault(),a.stopPropagation(),e();const i={suggestedWidth:+(b.dataset.width||1200),suggestedHeight:+(b.dataset.height||630),isFlex:+(b.dataset.flex||1),minWidth:+(b.dataset.minWidth||200),minHeight:+(b.dataset.minHeight||200)};p.control={params:{flex_width:i.isFlex?4096:0,flex_height:i.isFlex?4096:0,width:i.suggestedWidth,height:i.suggestedHeight,isFlex:i.isFlex,minWidth:i.minWidth,minHeight:i.minHeight}},h=wp.media({button:{text:o.labels[d].imgFrameButton,close:!1},states:[new wp.media.controller.Library({title:o.labels[d].imgFrameTitle,library:wp.media.query({type:"image"}),multiple:!1,date:!1,priority:20,suggestedWidth:i.suggestedWidth,suggestedHeight:i.suggestedHeight}),new p({imgSelectOptions:f})]});const j=document.getElementById(`${g}-url`),k=document.getElementById(`${g}-id`),l=()=>{h.setState("cropper")};h.off("select",l),h.on("select",l);const m=a=>{let b=a.url,c=a.id;j&&(j.value=b,j.dispatchEvent(new Event("change"))),k&&(k.value=c,k.dispatchEvent(new Event("change")))};h.off("cropped",m),h.on("cropped",m);const n=a=>{let b=a.get("url"),c=a.get("id");j&&(j.value=b,j.dispatchEvent(new Event("change"))),k&&(k.value=c,k.dispatchEvent(new Event("change")))};h.off("skippedcrop",n),h.on("skippedcrop",n);const q=a=>{b.textContent=o.labels[d].imgChange,j&&(j.readOnly=!0),c(b,!0),"tsfAys"in window&&tsfAys.registerChange()};h.off("skippedcrop cropped",q),h.on("skippedcrop cropped",q),h.open()}function c(b,c){const d=b.dataset?.inputId,e=b.dataset?.inputType;if(d&&e&&!document.getElementById(`${d}-remove`)){const f=document.createElement("button");f.type="button",f.id=`${d}-remove`,f.dataset.inputId=d,f.dataset.inputType=e,f.title=tsf.decodeEntities(o.labels[e].imgRemoveTitle),f.innerHTML=tsf.escapeString(tsf.decodeEntities(o.labels[e].imgRemove)),f.classList.add("tsf-remove-image-button",...(JSON.parse(b.dataset?.buttonClass||0)?.remove||[])),b.insertAdjacentElement("afterend",f),c&&a(f).css("opacity",0).animate({opacity:1},{queue:!0,duration:1e3}),k()}}function d(b){const c=b.target.dataset.inputId,d=b.target.dataset.inputType;if(!c||!d)return;const e=document.getElementById(`${c}-select`);if(e.disabled)return;e.disabled=!0,e.classList.add("disabled");const f=document.getElementById(`${c}-remove`);f&&(f.disabled=!0,f.classList.add("disabled"),a(f).fadeOut(250,()=>{f.remove(),e.textContent=o.labels[d].imgSelect,e.classList.remove("disabled"),e.disabled=!1}));const g=document.getElementById(`${c}-url`);g&&(g.value="",g.dispatchEvent(new Event("change")),!g.dataset.readonly&&(g.readOnly=!1));const h=document.getElementById(`${c}-id`);h&&(h.value="",h.dispatchEvent(new Event("change"))),"tsfAys"in window&&tsfAys.registerChange()}function e(){if("undefined"!=typeof p.control)return;const a=wp.media.view,b=a.Cropper.extend({className:"crop-content tsf-image",ready:function(){a.Cropper.prototype.ready.apply(this,arguments)},onImageLoad:function(){let a,b=this.controller.get("imgSelectOptions");"function"==typeof b&&(b=b(this.options.attachment,this.controller)),"undefined"==typeof b.aspectRatio&&(b=_.extend(b,{parent:this.$el,onInit:function(){this.parent.children().on("mousedown touchstart",function(b){b.shiftKey?a.setOptions({aspectRatio:"1:1"}):a.setOptions({aspectRatio:!1})})}})),this.trigger("image-loaded"),a=this.controller.imgSelect=this.$image.imgAreaSelect(b)}}),c=wp.media.controller.Cropper.extend({createCropContent:function(){this.cropperView=new b({controller:this,attachment:this.get("selection").first()}),this.cropperView.on("image-loaded",this.createCropToolbar,this),this.frame.content.set(this.cropperView)},doCrop:function(a){var b=Math.round;let c=a.get("cropDetails"),d=p.control;if(d.params.flex_width&&d.params.flex_height)if(c.width===c.height)c.width>d.params.flex_width&&(c.dst_width=c.dst_height=d.params.flex_width);else if(c.width>d.params.flex_width||c.height>d.params.flex_height)if(c.width>c.height){let a=c.width/d.params.flex_width;c.dst_width=d.params.flex_width,c.dst_height=b(c.height/a)}else{let a=c.height/d.params.flex_height;c.dst_height=d.params.flex_height,c.dst_width=b(c.width/a)}return"undefined"==typeof c.dst_width&&(c.dst_width=0,c.dst_height=0),wp.ajax.post("tsf_crop_image",{nonce:o.nonce,id:a.get("id"),context:"tsf-image",cropDetails:c})}});c.prototype.control={},p=c}function f(a,b){const c=p.control;let d=parseInt(c.params.width,10),e=parseInt(c.params.height,10);const f=!!parseInt(c.params.flex_width,10),h=!!parseInt(c.params.flex_height,10),i=a.get("width"),j=a.get("height"),k=d/e,l=d,m=e;let n;n=c.params.isFlex?!g(c.params.flex_width,c.params.flex_height,i,j):k===i/j,b.set("control",c.params),b.set("canSkipCrop",n),i/j>k?(e=j,d=e*k):(d=i,e=d/k);let o=(i-d)/2,q=(j-e)/2;const r={handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:i,imageHeight:j,minWidth:l>d?d:l,minHeight:m>e?e:m,x1:o,y1:q,x2:d+o,y2:e+q};return c.params.isFlex?h||f?(h&&(r.minHeight=c.params.minHeight,r.maxWidth=i),f&&(r.minWidth=c.params.minWidth,r.maxHeight=j)):r.aspectRatio=`${d}:${e}`:(r.handles="corners",r.aspectRatio=`${d}:${e}`),r}function g(a,b,c,d){return c>a||d>b}function h(a){const b=a.target.dataset.id||"",c=a.target.dataset.type||"";if(b&&c){const d=document.getElementById(`${b}-select`);d.disabled||(d.textContent=a.target.value.length?o.labels[c].imgChange:o.labels[c].imgSelect)}}function i(){document.querySelectorAll(".tsf-set-image-button").forEach(a=>{const b=a.dataset.inputId||"",d=b&&document.getElementById(`${b}-id`),e=b&&document.getElementById(`${b}-url`);d&&0<d.value&&(e&&(e.readOnly=!0),c(a,!1)),e&&(e.addEventListener("change",h),e.dispatchEvent(new Event("change")))})}function j(){document.querySelectorAll(".tsf-set-image-button").forEach(a=>{a.addEventListener("click",b)})}function k(){document.querySelectorAll(".tsf-remove-image-button").forEach(a=>{a.addEventListener("click",d)})}function l(){j(),k(),document.querySelectorAll(".tsf-enable-media-if-js").forEach(a=>{a.disabled=!1,a.classList.remove("tsf-enable-media-if-js")}),i(),n()}function m(b){const c=b.target.id?.replace(/-[a-z]+$/,""),d=c&&document.getElementById(`${c}-preview`);if(!d)return;c in q&&clearTimeout(q[c]);let e=d.dataset.tsfLoaded||!1;d.dataset.tsfLoaded=1;let f=b.target.value||b.target.placeholder||"";const g=()=>{let b="max-width:225px;max-height:225px;min-width:60px;min-height:60px;border-radius:3px;display:block;";return f.length?void(d.dataset.desc=`<img src=${tsf.escapeString(f)} style="${b}" />`,e?a(d).not(":visible").fadeIn(250):a(d).show(),new Image().src=f,tsfTT.triggerUpdate(d)):void(e?a(d).not(":hidden").fadeOut(250):a(d).hide())};q[c]=setTimeout(g,e&&f.length?1e3/(115/60):0)}function n(){document.querySelectorAll(".tsf-image-preview").forEach(a=>{const b=document.getElementById(`${a.dataset.for}-url`);b&&(b.addEventListener("input",m),b.addEventListener("change",m),b.dispatchEvent(new Event("change")))})}const o="undefined"!=typeof tsfMediaL10n&&tsfMediaL10n;let p={},q={};const r=tsfUtils.debounce(l,500);return Object.assign({load:()=>{document.body.addEventListener("tsf-ready",l)}},{resetImageEditorActions:r},{l10n:o})}(jQuery),window.tsfMedia.load();
