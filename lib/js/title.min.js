"use strict";window.tsfTitle=function(){function a(a){return L.get(a)||""}function b(a){return M.get(a)||""}function c(b,c){return L.set(b,c)&&a(b)}function d(a,c){return M.set(a,c)&&b(a)}function e(a){return document.getElementById(`tsf-title-placeholder-prefix_${a}`)||document.createElement("span")}function f(a){return document.getElementById(`tsf-title-placeholder-additions_${a}`)||document.createElement("span")}function g(a){return J.get(a)}function h(a,b){return b?K[a]?.[b]:K[a]}function i(a,b,c){if(K[a][b]!==c)switch(K[a][b]=c,b){case"showPrefix":case"prefixValue":case"prefixPlacement":n(a),w(a);break;case"addAdditions":case"separator":case"additionValue":case"additionPlacement":m(a),w(a);break;case"allowReferenceChange":case"defaultTitle":default:w(a)}}function j(a){return[document.getElementById(`tsf-title-reference_${a}`)]}function k(a){return[document.getElementById(`tsf-title-noadditions-reference_${a}`)]}function l(c){const d=j(c.target.id),e=k(c.target.id);if(!d[0]||!e[0])return;const f=h(c.target.id,"allowReferenceChange");let g=tsf.coalesceStrlen(f&&c.target.value.trim())??tsf.coalesceStrlen(h(c.target.id,"defaultTitle"))??"",i=g;if(g.length&&f){let d=b(c.target.id),e=a(c.target.id);if(d.length&&h(c.target.id,"showPrefix")){switch(h(c.target.id,"prefixPlacement")){case"before":window.isRtl?g+=d:g=d+g;break;case"after":window.isRtl?g=d+g:g+=d}i=g}if(e.length)switch(h(c.target.id,"additionPlacement")){case"before":g=e+g;break;case"after":g+=e}}const l=tsf.escapeString(tsf.decodeEntities(tsf.sDoubleSpace(tsf.sTabs(tsf.sSingleLine(g).trim())))),m=tsf.escapeString(tsf.decodeEntities(tsf.sDoubleSpace(tsf.sTabs(tsf.sSingleLine(i).trim())))),n=new Event("change");d.forEach(a=>{a.innerHTML=l,setTimeout(()=>{a.dispatchEvent(n)},0)}),e.forEach(a=>{a.innerHTML=m,setTimeout(()=>{a.dispatchEvent(n)},0)})}function m(a){let b="",d="",e="";if(h(a,"addAdditions")&&(d=tsf.escapeString(tsf.decodeEntities(h(a,"additionValue"))),e=h(a,"separator")),d)switch(h(a,"additionPlacement")){case"before":b=`${d} ${e} `;break;case"after":b=` ${e} ${d}`}f(a).innerHTML=c(a,b||"")}function n(a){let b="",c=h(a,"showPrefix"),f=h(a,"prefixValue");if(c&&f)switch(h(a,"prefixPlacement")){case"before":b=window.isRtl?` ${f}`:`${f} `;break;case"after":b=window.isRtl?`${f} `:` ${f}`}e(a).innerHTML=d(a,b||"")}function o(c){var d=Math.max,g=Math.min;let i=f(c.target.id),j=e(c.target.id);if(!i&&!j)return;const k=c.target,l=c.target.value,m=b(c.target.id).length&&h(c.target.id,"showPrefix"),n=!!a(c.target.id).length;if(!m&&j&&(j.style.display="none"),!n&&i&&(i.style.display="none"),!m&&!n)return void(k.style.textIndent="initial");if(!l.length)return k.style.textIndent="initial",j&&(j.style.display="none"),void(i&&(i.style.display="none"));const o=getComputedStyle(k),p=k.getBoundingClientRect(),q=parseInt(o.paddingTop),r=parseInt(o.paddingRight),s=parseInt(o.paddingBottom),t=parseInt(o.paddingLeft),u=parseInt(o.borderTopWidth),v=parseInt(o.borderRightWidth),w=parseInt(o.borderBottomWidth),x=parseInt(o.borderTopWidth),y=parseInt(o.marginTop),z=parseInt(o.marginRight),A=parseInt(o.marginBottom),B=parseInt(o.marginLeft),C=window.isRtl?"right":"left",D=t+x+B,E=r+v+z;let F={display:o.display,lineHeight:o.lineHeight,fontFamily:o.fontFamily,fontWeight:o.fontWeight,fontSize:o.fontSize,letterSpacing:o.letterSpacing,marginTop:`${y}px`,marginBottom:`${A}px`,paddingTop:`${q}px`,paddingBottom:`${s}px`,border:`0 solid transparent`,borderTopWidth:`${u}px`,borderBottomWidth:`${w}px`},G=0,H=0,I=0,J=0,K=0;if(m&&(Object.assign(j.style,F,{maxWidth:"initial"}),K=j.getBoundingClientRect().width,I+=D),n){Object.assign(i.style,F,{maxWidth:"initial"});const a=document.getElementById(`tsf-title-offset_${c.target.id}`);a.textContent=l,Object.assign(a.style,{fontFamily:F.fontFamily,fontWeight:F.fontWeight,fontSize:F.fontSize,letterSpacing:F.letterSpacing});const b=a.getBoundingClientRect().width,e=i.getBoundingClientRect().width;switch(h(c.target.id,"additionPlacement")){case"before":G=p.width-E-t-x-b-K,0>G&&(K+=G,G=0),G=d(0,g(G,e)),J+=G,I+=G,H+=D;break;case"after":G=p.width-D-r-v-b-K,0>G&&(K+=G,G=0),G=d(0,g(G,e)),H+=D+b+K}}K=d(0,K),m&&(Object.assign(j.style,{[C]:`${I}px`,maxWidth:`${K}px`}),J+=K),n&&Object.assign(i.style,{[C]:`${H}px`,maxWidth:`${G}px`}),k.style.textIndent=`${J}px`}function p(a){a.target.placeholder=j(a.target.id)[0].textContent}function q(a){const b=document.getElementById(`${a.target.id}_chars`),c=j(a.target.id)[0];b&&tsfC?.updateCharacterCounter({e:b,text:c.innerHTML,field:"title",type:"search"})}function r(a){const b=document.getElementById(`${a.target.id}_pixels`),c=j(a.target.id)[0];b&&tsfC?.updatePixelCounter({e:b,text:c.innerHTML,field:"title",type:"search"})}function s(a){a?g(a)?.dispatchEvent(new Event("input")):J.forEach(a=>a.id&&s(a.id))}function t(a){a?g(a)?.dispatchEvent(new CustomEvent("tsf-update-title-counter")):J.forEach(a=>a.id&&t(a.id))}function u(a){o(a),l(a),p(a),v(a)}function v(a){q(a),r(a)}function w(a){a in N&&clearTimeout(N[a]),N[a]=setTimeout(()=>s(a),1e3/60)}function x(a){if("tsfAys"in window){let b=tsfAys.areSettingsChanged();s(a),!b&&tsfAys.areSettingsChanged()&&tsfAys.reset()}else s(a)}function y(a){a in O&&clearTimeout(O[a]),O[a]=setTimeout(()=>x(a),1e3/60)}function z(a){let b=document.getElementById(a.target.dataset.for);if(b){let c=a.target.classList.contains("tsf-title-placeholder-additions")?"additions":"prefix",d=b.value;switch(b.focus(),a.detail){case 3:b.setSelectionRange(0,d.length);break;case 2:let a,e;"additions"===c&&"after"===h(b.id,"additionPlacement")||"prefix"===c&&window.isRtl?(a=d.replace(/(\w+|\s+)$/u,"").length,e=d.length):(a=0,e=d.length-d.replace(/^(\s+|\w+)/u,"").length),b.setSelectionRange(a,e);break;case 1:default:let f="additions"===c&&"after"===h(b.id,"additionPlacement")?d.length:0;b.setSelectionRange(f,f)}}}function A(a){return a.preventDefault()}function B(){let a=window.innerWidth;P<a?782>=P&&782<=a&&x():782<=P&&782>=a&&x(),P=a}function C(){window.addEventListener("tsf-resize",B),window.addEventListener("tsf-counter-updated",()=>y())}function D(a){if(!(!a instanceof Element)){a.addEventListener("input",u),a.addEventListener("tsf-update-title-counter",v);let b=e(a.id),c=f(a.id);b.addEventListener("click",z),c.addEventListener("click",z),b.addEventListener("mousedown",A),c.addEventListener("mousedown",A),m(a.id),n(a.id),y(a.id)}}const E="undefined"!=typeof tsfTitleL10n&&tsfTitleL10n,F=tsf.escapeString(E.params.untitledTitle),G=tsf.escapeString(E.i18n.protectedTitle),H=tsf.escapeString(E.i18n.privateTitle),I=!!E.params.stripTitleTags,J=new Map,K={},L=new Map,M=new Map;let N={},O={},P=window.innerWidth;return Object.assign({load:()=>{document.body.addEventListener("tsf-onload",C)}},{setInputElement:function b(a){return J.set(a.id,a),K[a.id]={showPrefix:!0,allowReferenceChange:!0,defaultTitle:"",separator:E.states.titleSeparator,prefixPlacement:E.states.prefixPlacement},D(a),g(a.id)},getInputElement:g,getStateOf:h,updateStateOf:i,updateStateAll:function d(a,b,c){c=Array.isArray(c)?c:[c],J.forEach(d=>{c.includes(d.id)||i(d.id,a,b)})},triggerCounter:t,triggerInput:s,enqueueTriggerInput:w,triggerUnregisteredInput:x,enqueueUnregisteredInputTrigger:y},{l10n:E,untitledTitle:F,privatePrefix:H,protectedPrefix:G,stripTitleTags:I})}(),window.tsfTitle.load();
